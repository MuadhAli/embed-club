<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./workshop.css">
        <title>Workshop</title>
</head>
<body>

    <div class="card-container">
        <div class="card" id="card1">
            <img src="./workshop/node.jpg" alt="Image 1">
            <h3>PinOut diagram of the Node MCU esp8266</h3>
        </div>
        <div class="card" id="card2">
            <img src="./workshop/arduino-logo.jpg" alt="Image 2">
            <h3>IDE SETUP FILES</h3>
        </div>
        <div class="card" id="card3">
            <img src="./workshop/automation.png" alt="Image 3">
            <h3>HOME-AUTOMATION USING GOOGLE HOME, NODEMCU, SINRIC PRO</h3>
        </div>
        <div class="card" id="card4">
            <img src="image4.jpg" alt="Image 4">
            <h3>Card 4</h3>
        </div>

    </div>

    <!-- Add unique modals for each card -->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img src="./workshop/image-cont.png" alt="node mcu">
            <img src="./workshop/image-cont1.png" alt="node mcu">
            <p>This is the Pin Out diagram of the node mcu</p>
            <button class="copy-btn">Copy</button>
        </div>
    </div>

    <div id="modal2" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p> <h1> Installation:</h1><br>
                Link1: <a href="https://www.arduined.eu/files/windows8/CH341SER.zip"> click to download</a><br>
                Link1: <a href="https://www.silabs.com/documents/public/software/CP210x_Universal_Windows_Driver.zip"> click to download</a> <br>
                
                <h1> Boards Manager URL:                </h1><br>
                http://arduino.esp8266.com/stable/package_esp8266com_index.json

            </p>
            <button class="copy-btn">Copy</button>
        </div>
    </div>

    <div id="modal3" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <textarea class="text-area"> 
                Libraries to Add:

                * ArduinoJSON
                * WEBSOCKETS
                * SinricPro_Generic



                
                // **************************** CODE BEGIN ***********************************
                
                #ifdef ENABLE_DEBUG
                        #define DEBUG_ESP_PORT Serial
                        #define NODEBUG_WEBSOCKETS
                        #define NDEBUG
                 #endif  
                 
                 #include <Arduino.h>
                 #ifdef ESP8266  
                        #include <ESP8266WiFi.h>
                 #endif  
                 #ifdef ESP32    
                        #include <WiFi.h>
                 #endif
                 
                 #include "SinricPro.h"
                 #include "SinricProSwitch.h"
                 
                 #include <map>
                 
                 #define WIFI_SSID         "hello"     
                 #define WIFI_PASS         "helloworld"
                 #define APP_KEY           "6fa2c48b-b08b-438f-9d93-32064ae6fc94"       
                 #define APP_SECRET        "850fa29f-a022-400f-b25b-52ab04621c41-d83afab4-ba1c-434e-8d66-a77244ad3c23"   
                 // comment the following line if you use a toggle switches instead of tactile buttons
                 //#define TACTILE_BUTTON 1
                 
                 #define BAUD_RATE   9600
                 
                 #define DEBOUNCE_TIME 250
                 
                 typedef struct {      // struct for the std::map below
                   int relayPIN;
                   int flipSwitchPIN;
                 } deviceConfig_t;
                 
                 
                 // this is the main configuration
                 // please put in your deviceId, the PIN for Relay and PIN for flipSwitch
                 // this can be up to N devices...depending on how much pin's available on your device ;)
                 // right now we have 4 devicesIds going to 4 relays and 4 flip switches to switch the relay manually
                 std::map<String, deviceConfig_t> devices = {
                     //{deviceId, {relayPIN to be connected,  flipSwitchPIN}}
                     {"62c0162ead95bfbcdf34503a", {  D1, D8 }},
                     {"62c01650ad95bfbcdf345066", {  D2, D7 }},
                     {"62c015cb0aec232058f3f638", {  D3, D6 }},
                     {"SWITCH_ID_NO_4_HERE", {  D4, D5 }}       
                 };
                 
                 typedef struct {      // struct for the std::map below
                   String deviceId;
                   bool lastFlipSwitchState;
                   unsigned long lastFlipSwitchChange;
                 } flipSwitchConfig_t;
                 
                 std::map<int, flipSwitchConfig_t> flipSwitches;    // this map is used to map flipSwitch PINs to deviceId and handling debounce and last flipSwitch state checks
                                                                   // it will be setup in "setupFlipSwitches" function, using informations from devices map
                 
                 void setupRelays() {  
                   for (auto &device : devices) {           // for each device (relay, flipSwitch combination)
                     int relayPIN = device.second.relayPIN; // get the relay pin
                     pinMode(relayPIN, OUTPUT);             // set relay pin to OUTPUT
                   }
                 }
                 
                 void setupFlipSwitches() {
                   for (auto &device : devices)  {                     // for each device (relay / flipSwitch combination)
                     flipSwitchConfig_t flipSwitchConfig;              // create a new flipSwitch configuration
                 
                     flipSwitchConfig.deviceId = device.first;         // set the deviceId
                     flipSwitchConfig.lastFlipSwitchChange = 0;        // set debounce time
                     flipSwitchConfig.lastFlipSwitchState = false;     // set lastFlipSwitchState to false (LOW)
                 
                     int flipSwitchPIN = device.second.flipSwitchPIN;  // get the flipSwitchPIN
                 
                     flipSwitches[flipSwitchPIN] = flipSwitchConfig;   // save the flipSwitch config to flipSwitches map
                     pinMode(flipSwitchPIN, INPUT);                   // set the flipSwitch pin to INPUT
                   }
                 }
                 
                 bool onPowerState(String deviceId, bool &state)
                 {
                   Serial.printf("%s: %s\r\n", deviceId.c_str(), state ? "on" : "off");
                   int relayPIN = devices[deviceId].relayPIN; // get the relay pin for corresponding device
                   digitalWrite(relayPIN, !state);             // set the new relay state
                   return true;
                 }
                 
                 void handleFlipSwitches() {
                   unsigned long actualMillis = millis();                                          // get actual millis
                   for (auto &flipSwitch : flipSwitches) {                                         // for each flipSwitch in flipSwitches map
                     unsigned long lastFlipSwitchChange = flipSwitch.second.lastFlipSwitchChange;  // get the timestamp when flipSwitch was pressed last time (used to debounce / limit events)
                 
                     if (actualMillis - lastFlipSwitchChange > DEBOUNCE_TIME) {                    // if time is > debounce time...
                 
                       int flipSwitchPIN = flipSwitch.first;                                       // get the flipSwitch pin from configuration
                       bool lastFlipSwitchState = flipSwitch.second.lastFlipSwitchState;           // get the lastFlipSwitchState
                       bool flipSwitchState = digitalRead(flipSwitchPIN);                          // read the current flipSwitch state
                       if (flipSwitchState != lastFlipSwitchState) {                               // if the flipSwitchState has changed...
                 #ifdef TACTILE_BUTTON
                         if (flipSwitchState) {                                                    // if the tactile button is pressed  
                 #endif       
                           flipSwitch.second.lastFlipSwitchChange = actualMillis;                  // update lastFlipSwitchChange time
                           String deviceId = flipSwitch.second.deviceId;                           // get the deviceId from config
                           int relayPIN = devices[deviceId].relayPIN;                              // get the relayPIN from config
                           bool newRelayState = !digitalRead(relayPIN);                            // set the new relay State
                           digitalWrite(relayPIN, newRelayState);                                  // set the trelay to the new state
                 
                           SinricProSwitch &mySwitch = SinricPro[deviceId];                        // get Switch device from SinricPro
                           mySwitch.sendPowerStateEvent(!newRelayState);                            // send the event
                 #ifdef TACTILE_BUTTON
                         }
                 #endif       
                         flipSwitch.second.lastFlipSwitchState = flipSwitchState;                  // update lastFlipSwitchState
                       }
                     }
                   }
                 }
                 
                 void setupWiFi()
                 {
                   Serial.printf("\r\n[Wifi]: Connecting");
                   WiFi.begin(WIFI_SSID, WIFI_PASS);
                 
                   while (WiFi.status() != WL_CONNECTED)
                   {
                     Serial.printf(".");
                     delay(250);
                   }
                   digitalWrite(LED_BUILTIN, HIGH);
                   Serial.printf("connected!\r\n[WiFi]: IP-Address is %s\r\n", WiFi.localIP().toString().c_str());
                 }
                 
                 void setupSinricPro()
                 {
                   for (auto &device : devices)
                   {
                     const char *deviceId = device.first.c_str();
                     SinricProSwitch &mySwitch = SinricPro[deviceId];
                     mySwitch.onPowerState(onPowerState);
                   }
                 
                   SinricPro.begin(APP_KEY, APP_SECRET);
                   SinricPro.restoreDeviceStates(true);
                 }
                 
                 void setup()
                 {
                   Serial.begin(BAUD_RATE);
                   setupRelays();
                   setupFlipSwitches();
                   setupWiFi();
                   setupSinricPro();
                 }
                 
                 void loop()
                 {
                   SinricPro.handle();
                   handleFlipSwitches();
                 }
                
                
// ************************ CODE END *********************
            </textarea>
            <button class="copy-btn">Copy</button>
        </div>
    </div>

    <div id="modal4" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>This is the content for Card 4 modal.</p>
            <button class="copy-btn">Copy</button>
        </div>
    </div>

    <div id="modal5" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>This is the content for Card 5 modal.</p>
            <button class="copy-btn">Copy</button>
        </div>
    </div>


    <script src="./workshop.js"></script>
</body>
</html>
